openapi: 3.0.3
info:
  title: StylistMatch API
  version: 0.1.0
  description: API for Smart Booking System with AI recommendations (Architect: StylistMatch)
servers:
  - url: https://api.example.com
security:
  - bearerAuth: []

components:
  securitySchemes:
    bearerAuth:
      type: http
      scheme: bearer
      bearerFormat: JWT

  schemas:
    User:
      type: object
      required: [id, name, email, role]
      properties:
        id:
          type: string
          format: uuid
        name:
          type: string
        email:
          type: string
          format: email
        role:
          type: string
          enum: [client, stylist, admin]
        preferences:
          type: object
          description: JSON object for user preferences

    Salon:
      type: object
      properties:
        id: { type: string, format: uuid }
        owner_id: { type: string, format: uuid }
        name: { type: string }
        location: { type: string }

    Service:
      type: object
      properties:
        id: { type: string, format: uuid }
        salon_id: { type: string, format: uuid }
        name: { type: string }
        duration_min: { type: integer }
        base_price: { type: number, format: float }

    Booking:
      type: object
      properties:
        id: { type: string, format: uuid }
        user_id: { type: string, format: uuid }
        salon_id: { type: string, format: uuid }
        service_id: { type: string, format: uuid }
        stylist_id: { type: string, format: uuid }
        start_at: { type: string, format: date-time }
        end_at: { type: string, format: date-time }
        status:
          type: string
          enum: [pending, confirmed, cancelled, completed]
        price_total: { type: number }

    StyleRecommendation:
      type: object
      properties:
        styles:
          type: array
          items:
            type: object
            properties:
              name: { type: string }
              description: { type: string }
              confidence: { type: number }
              recommended_service_id: { type: string }
        audit_notes: { type: array, items: { type: string } }

    PriceBreakdown:
      type: object
      properties:
        base_price: { type: number }
        dynamic_markup: { type: number }
        addons: { type: number }
        final_price: { type: number }

paths:
  /auth/signup:
    post:
      summary: Sign up
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                name: { type: string }
                email: { type: string }
                password: { type: string }
      responses:
        '201':
          description: Created

  /auth/login:
    post:
      summary: Log in
      requestBody:
        content:
          application/json:
            schema:
              type: object
              properties:
                email: { type: string }
                password: { type: string }
      responses:
        '200':
          description: token
          content:
            application/json:
              schema:
                type: object
                properties:
                  token: { type: string }

  /salons/{id}/services:
    get:
      summary: List services for salon
      parameters:
        - in: path
          name: id
          required: true
          schema:
            type: string
      responses:
        '200':
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/Service'

  /price/calc:
    post:
      summary: Calculate price
      requestBody:
        content:
          application/json:
            schema:
              type: object
              properties:
                service_id: { type: string }
                addons: { type: array, items: { type: string } }
                datetime: { type: string }
      responses:
        '200':
          description: price
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/PriceBreakdown'

  /recommend/style:
    post:
      summary: Get AI style recommendations (uses o1-preview as audit/oracle)
      requestBody:
        content:
          application/json:
            schema:
              type: object
              properties:
                photo_url: { type: string }
                event_type: { type: string }
                user_preferences: { type: object }
      responses:
        '200':
          description: recommendations
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/StyleRecommendation'

  /bookings:
    post:
      summary: Create booking (checks conflicts and calculates price)
      security:
        - bearerAuth: []
      requestBody:
        content:
          application/json:
            schema:
              type: object
              properties:
                user_id: { type: string }
                salon_id: { type: string }
                service_id: { type: string }
                stylist_id: { type: string }
                start_at: { type: string }
      responses:
        '201':
          description: booking created
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Booking'
